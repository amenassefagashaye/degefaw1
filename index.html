<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>·ä†·à∞·çã ·ã≤·åÇ·â≥·àç ·â¢·äï·åé ·å®·ãã·â≥</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Ethiopic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* MOBILE FIRST DESIGN - OPTIMIZED */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Times New Roman', 'Noto Sans Ethiopic', sans-serif;
            background: linear-gradient(135deg, #0d47a1 0%, #1a237e 100%);
            color: white;
            touch-action: manipulation;
        }

        .amharic-text {
            font-family: 'Noto Sans Ethiopic', 'Times New Roman', sans-serif;
        }

        /* TRIPLE BORDER CONTAINER */
        .border-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 12px;
            pointer-events: none;
            z-index: 1000;
        }

        .border-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 3px solid rgba(255, 215, 0, 0.7);
            border-radius: 20px;
            pointer-events: none;
        }

        .border-layer:nth-child(2) {
            top: 6px;
            left: 6px;
            border-color: rgba(255, 87, 34, 0.7);
        }

        .border-layer:nth-child(3) {
            top: 12px;
            left: 12px;
            border-color: rgba(76, 175, 80, 0.7);
        }

        /* GAME CONTAINER */
        .game-container {
            position: relative;
            width: 100%;
            height: 100%;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* HEADER */
        .header {
            text-align: center;
            margin-bottom: 15px;
            width: 100%;
        }

        .title {
            font-size: 2.2rem;
            margin-bottom: 5px;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1.2rem;
            color: #BBDEFB;
            margin-bottom: 15px;
        }

        /* GAME STATUS */
        .game-status {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 20px;
            width: 100%;
            text-align: center;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .status-text {
            font-size: 1.3rem;
            margin-bottom: 8px;
        }

        .connection-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            background-color: #f44336;
        }

        .connection-status.connected {
            background-color: #4CAF50;
        }

        /* BINGO CARD */
        .bingo-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .bingo-card {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-gap: 8px;
            margin-bottom: 15px;
        }

        .bingo-header {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-gap: 8px;
            margin-bottom: 10px;
        }

        .bingo-header-cell {
            text-align: center;
            font-weight: bold;
            font-size: 1.5rem;
            color: #FFD700;
            padding: 8px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .bingo-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            font-size: 1.6rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .bingo-cell:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .bingo-cell.selected {
            background: #4CAF50;
            color: white;
            transform: scale(0.95);
            border-color: #FFD700;
        }

        .bingo-cell.free {
            background: #FF9800;
            color: white;
            font-size: 1.3rem;
        }

        /* CONTROLS */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            width: 100%;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 140px;
            text-align: center;
            font-family: 'Noto Sans Ethiopic', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(to right, #FF9800, #FF5722);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* CALLED NUMBERS */
        .called-numbers-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 15px;
            width: 100%;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .called-numbers-title {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: #FFD700;
            text-align: center;
        }

        .called-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            max-height: 120px;
            overflow-y: auto;
        }

        .called-number {
            background: rgba(33, 150, 243, 0.8);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .called-number.recent {
            background: #FF5722;
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* WINNER MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 90%;
            width: 400px;
            border: 3px solid #FFD700;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .modal-title {
            font-size: 2.2rem;
            color: #FFD700;
            margin-bottom: 15px;
        }

        .modal-text {
            font-size: 1.3rem;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        /* RESPONSIVE DESIGN */
        @media (min-width: 768px) {
            .title {
                font-size: 2.8rem;
            }
            
            .bingo-cell {
                font-size: 1.8rem;
            }
            
            .btn {
                min-width: 160px;
                padding: 14px 24px;
            }
        }

        @media (max-height: 700px) {
            .game-container {
                padding: 10px;
            }
            
            .title {
                font-size: 1.8rem;
            }
            
            .bingo-cell {
                font-size: 1.4rem;
            }
        }

        /* LOADING SPINNER */
        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #FFD700;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Triple Border Container -->
    <div class="border-container">
        <div class="border-layer"></div>
        <div class="border-layer"></div>
        <div class="border-layer"></div>
    </div>

    <!-- Game Container -->
    <div class="game-container">
        <!-- Header -->
        <div class="header">
            <h1 class="title amharic-text">·ä†·à∞·çã ·ã≤·åÇ·â≥·àç ·â¢·äï·åé ·å®·ãã·â≥</h1>
            <p class="subtitle amharic-text">·ã®·ä¢·âµ·ãÆ·åµ·ã´ ·â£·àÖ·àã·ãä ·â¢·äï·åé ·å®·ãã·â≥</p>
        </div>

        <!-- Game Status -->
        <div class="game-status">
            <div class="status-text amharic-text">
                <span class="connection-status" id="connectionStatus"></span>
                <span id="statusMessage">·ãà·ã∞ ·ä†·åà·àç·åã·ã≠ ·â†·àò·åà·äì·äò·âµ ·àã·ã≠...</span>
            </div>
            <div id="gameInfo" class="amharic-text">·å®·ãã·â≥·ãç ·àà·àò·åÄ·àò·à≠ ·â†·àò·å†·â†·âÖ ·àã·ã≠</div>
        </div>

        <!-- Bingo Card -->
        <div class="bingo-container">
            <div class="bingo-header">
                <div class="bingo-header-cell amharic-text">·â¢</div>
                <div class="bingo-header-cell amharic-text">·ä¢</div>
                <div class="bingo-header-cell amharic-text">·äï</div>
                <div class="bingo-header-cell amharic-text">·åé</div>
                <div class="bingo-header-cell amharic-text">!</div>
            </div>
            <div class="bingo-card" id="bingoCard">
                <!-- Bingo cells will be generated by JavaScript -->
            </div>
            <div class="amharic-text" style="text-align: center; font-size: 1.1rem; color: #BBDEFB;">
                ·àà·àò·àù·à®·å• ·â†·âÅ·å•·à© ·àã·ã≠ ·ã≠·äï·ä©
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="btn btn-primary amharic-text" id="newGameBtn">·ä†·ã≤·àµ ·å®·ãã·â≥</button>
            <button class="btn btn-secondary amharic-text" id="autoPlayBtn">·à´·àµ-·à∞·à≠ ·àò·å´·ãà·âª</button>
            <button class="btn btn-secondary amharic-text" id="bingoBtn">·â¢·äï·åé! üéâ</button>
        </div>

        <!-- Called Numbers -->
        <div class="called-numbers-container">
            <div class="called-numbers-title amharic-text">·ã®·â∞·å†·à© ·âÅ·å•·àÆ·âΩ</div>
            <div class="called-numbers" id="calledNumbers">
                <!-- Called numbers will appear here -->
            </div>
        </div>

        <!-- Winner Modal -->
        <div class="modal" id="winnerModal">
            <div class="modal-content">
                <h2 class="modal-title amharic-text" id="winnerTitle">·â¢·äï·åé! üéâ</h2>
                <p class="modal-text amharic-text" id="winnerMessage">·ä•·äï·ä≥·äï ·ã∞·àµ ·ã´·àà·ãé! ·â¢·äï·åé ·ä†·à®·åâ!</p>
                <button class="btn btn-primary amharic-text" id="playAgainBtn">·â†·ãµ·åã·àö ·ã≠·å´·ãà·â±</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            connected: false,
            gameActive: false,
            playerId: null,
            gameId: null,
            bingoCard: [],
            calledNumbers: [],
            selectedNumbers: [],
            autoPlay: false,
            ws: null
        };

        // HTTP and WebSocket endpoints
        const HTTP_ENDPOINT = 'https://ameng-gogs-degefaw2-22.deno.dev/';
        const WS_ENDPOINT = 'wss://ameng-gogs-degefaw2-22.deno.dev/';

        // DOM Elements
        const connectionStatus = document.getElementById('connectionStatus');
        const statusMessage = document.getElementById('statusMessage');
        const gameInfo = document.getElementById('gameInfo');
        const bingoCard = document.getElementById('bingoCard');
        const calledNumbers = document.getElementById('calledNumbers');
        const newGameBtn = document.getElementById('newGameBtn');
        const autoPlayBtn = document.getElementById('autoPlayBtn');
        const bingoBtn = document.getElementById('bingoBtn');
        const winnerModal = document.getElementById('winnerModal');
        const winnerTitle = document.getElementById('winnerTitle');
        const winnerMessage = document.getElementById('winnerMessage');
        const playAgainBtn = document.getElementById('playAgainBtn');

        // Initialize the game
        function initGame() {
            updateStatus('·ãà·ã∞ ·ä†·åà·àç·åã·ã≠ ·â†·àò·åà·äì·äò·âµ ·àã·ã≠...', false);
            connectWebSocket();
            generateBingoCard();
            setupEventListeners();
        }

        // Connect to WebSocket backend
        function connectWebSocket() {
            try {
                gameState.ws = new WebSocket(WS_ENDPOINT);
                
                gameState.ws.onopen = function() {
                    console.log('WebSocket connected');
                    gameState.connected = true;
                    updateStatus('·ãà·ã∞ ·ä†·åà·àç·åã·ã≠ ·â∞·åà·äì·äù·â∑·àç', true);
                    
                    // Generate player ID if not exists
                    if (!gameState.playerId) {
                        gameState.playerId = 'player_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
                    }
                    
                    // Send player registration
                    sendWebSocketMessage({
                        type: 'register',
                        playerId: gameState.playerId
                    });
                };
                
                gameState.ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        handleWebSocketMessage(data);
                    } catch (e) {
                        console.error('Error parsing WebSocket message:', e);
                    }
                };
                
                gameState.ws.onclose = function() {
                    console.log('WebSocket disconnected');
                    gameState.connected = false;
                    updateStatus('·ä®·ä†·åà·àç·åã·ã≠ ·â∞·àà·ã≠·â∑·àç', false);
                    
                    // Try to reconnect after 3 seconds
                    setTimeout(connectWebSocket, 3000);
                };
                
                gameState.ws.onerror = function(error) {
                    console.error('WebSocket error:', error);
                    gameState.connected = false;
                    updateStatus('·ã®·åç·äï·äô·äê·âµ ·àµ·àÖ·â∞·âµ', false);
                };
            } catch (error) {
                console.error('Error connecting to WebSocket:', error);
                updateStatus('·ã®·åç·äï·äô·äê·âµ ·àµ·àÖ·â∞·âµ', false);
            }
        }

        // Send message via WebSocket
        function sendWebSocketMessage(message) {
            if (gameState.ws && gameState.ws.readyState === WebSocket.OPEN) {
                gameState.ws.send(JSON.stringify(message));
            } else {
                console.warn('WebSocket is not connected');
            }
        }

        // Handle incoming WebSocket messages
        function handleWebSocketMessage(data) {
            console.log('Received message:', data);
            
            switch (data.type) {
                case 'welcome':
                    handleWelcomeMessage(data);
                    break;
                case 'game_started':
                    handleGameStarted(data);
                    break;
                case 'number_called':
                    handleNumberCalled(data);
                    break;
                case 'game_update':
                    handleGameUpdate(data);
                    break;
                case 'bingo_validated':
                    handleBingoValidated(data);
                    break;
                case 'error':
                    handleErrorMessage(data);
                    break;
                default:
                    console.log('Unknown message type:', data.type);
            }
        }

        // Handle welcome message
        function handleWelcomeMessage(data) {
            updateStatus('·å®·ãã·â≥·ãç ·àà·àò·åÄ·àò·à≠ ·ãù·åç·åÅ ·äê·ãç', true);
            gameInfo.textContent = `·ã®·àõ·àà·çä·ã´ ·àò·â≥·ãà·âÇ·ã´: ${gameState.playerId.substring(0, 8)}...`;
        }

        // Handle game started
        function handleGameStarted(data) {
            gameState.gameId = data.gameId;
            gameState.gameActive = true;
            gameState.calledNumbers = [];
            gameState.selectedNumbers = [];
            
            updateStatus('·å®·ãã·â≥·ãç ·åÄ·àù·àØ·àç!', true);
            gameInfo.textContent = `·å®·ãã·â≥ ID: ${data.gameId}`;
            
            // Generate a new bingo card
            generateBingoCard();
            updateCalledNumbers([]);
            
            // If autoplay is enabled, start auto-selecting
            if (gameState.autoPlay) {
                startAutoPlay();
            }
        }

        // Handle number called
        function handleNumberCalled(data) {
            const number = data.number;
            
            // Add to called numbers
            if (!gameState.calledNumbers.includes(number)) {
                gameState.calledNumbers.push(number);
                updateCalledNumbers(gameState.calledNumbers);
                
                // Auto-select if autoplay is enabled
                if (gameState.autoPlay) {
                    autoSelectNumber(number);
                }
                
                // Check if number exists on our card
                const cellIndex = findNumberOnCard(number);
                if (cellIndex !== -1) {
                    // Highlight the cell briefly
                    const cell = document.querySelector(`.bingo-cell[data-index="${cellIndex}"]`);
                    if (cell) {
                        cell.classList.add('recent');
                        setTimeout(() => {
                            cell.classList.remove('recent');
                        }, 1000);
                    }
                }
            }
        }

        // Handle game update
        function handleGameUpdate(data) {
            if (data.calledNumbers) {
                gameState.calledNumbers = data.calledNumbers;
                updateCalledNumbers(gameState.calledNumbers);
                
                // Auto-select all called numbers if autoplay is enabled
                if (gameState.autoPlay) {
                    data.calledNumbers.forEach(number => {
                        autoSelectNumber(number);
                    });
                }
            }
        }

        // Handle bingo validation
        function handleBingoValidated(data) {
            if (data.valid) {
                showWinnerModal(data.playerId === gameState.playerId ? '·ä†·à∏·äì·çä' : '·àå·àã ·â∞·å´·ãã·âΩ');
            } else {
                alert('·ã´·àµ·åà·äô·âµ ·â¢·äï·åé ·âµ·ä≠·ä≠·àç ·ä†·ã≠·ã∞·àà·àù·ç¢ ·ä•·â£·ä≠·ãé ·ã≠·çà·âµ·àπ!');
            }
        }

        // Handle error message
        function handleErrorMessage(data) {
            alert(`·àµ·àÖ·â∞·âµ: ${data.message}`);
        }

        // Generate a bingo card
        function generateBingoCard() {
            // Clear existing card
            bingoCard.innerHTML = '';
            
            // Bingo card structure: 5x5 grid
            // Columns: B(1-15), I(16-30), N(31-45), G(46-60), O(61-75)
            const ranges = [
                {min: 1, max: 15},
                {min: 16, max: 30},
                {min: 31, max: 45},
                {min: 46, max: 60},
                {min: 61, max: 75}
            ];
            
            const cardNumbers = [];
            
            // Generate numbers for each column
            for (let col = 0; col < 5; col++) {
                const columnNumbers = [];
                const range = ranges[col];
                
                // Generate 5 unique numbers for this column
                while (columnNumbers.length < 5) {
                    const num = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
                    if (!columnNumbers.includes(num)) {
                        columnNumbers.push(num);
                    }
                }
                
                // Add to card numbers
                for (let row = 0; row < 5; row++) {
                    cardNumbers[row * 5 + col] = columnNumbers[row];
                }
            }
            
            // Make the center cell FREE
            cardNumbers[12] = 'FREE';
            
            // Save to game state
            gameState.bingoCard = cardNumbers;
            
            // Create bingo cells
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'bingo-cell';
                cell.dataset.index = i;
                cell.dataset.number = cardNumbers[i];
                
                if (cardNumbers[i] === 'FREE') {
                    cell.classList.add('free');
                    cell.textContent = '·äê·çÉ';
                    cell.classList.add('selected');
                } else {
                    cell.textContent = cardNumbers[i];
                }
                
                cell.addEventListener('click', () => selectNumber(i));
                bingoCard.appendChild(cell);
            }
            
            // Reset selected numbers
            gameState.selectedNumbers = [12]; // Free cell is always selected
        }

        // Select a number on the bingo card
        function selectNumber(index) {
            if (!gameState.gameActive) {
                alert('·å®·ãã·â≥·ãç ·ä†·àç·åÄ·àò·à®·àù·ç¢ ·ä•·â£·ä≠·ãé ·ä†·ã≤·àµ ·å®·ãã·â≥ ·ã≠·åÄ·àù·à©!');
                return;
            }
            
            const cell = document.querySelector(`.bingo-cell[data-index="${index}"]`);
            const number = cell.dataset.number;
            
            if (number === 'FREE') return; // Free cell is always selected
            
            if (cell.classList.contains('selected')) {
                cell.classList.remove('selected');
                const numIndex = gameState.selectedNumbers.indexOf(index);
                if (numIndex > -1) {
                    gameState.selectedNumbers.splice(numIndex, 1);
                }
            } else {
                cell.classList.add('selected');
                gameState.selectedNumbers.push(index);
            }
            
            // Check for bingo
            checkForBingo();
        }

        // Auto-select a number (for autoplay mode)
        function autoSelectNumber(number) {
            const index = findNumberOnCard(number);
            if (index !== -1 && !gameState.selectedNumbers.includes(index)) {
                const cell = document.querySelector(`.bingo-cell[data-index="${index}"]`);
                if (cell && !cell.classList.contains('selected') && !cell.classList.contains('free')) {
                    cell.classList.add('selected');
                    gameState.selectedNumbers.push(index);
                    
                    // Check for bingo
                    checkForBingo();
                }
            }
        }

        // Find a number on the bingo card
        function findNumberOnCard(number) {
            for (let i = 0; i < gameState.bingoCard.length; i++) {
                if (gameState.bingoCard[i] == number) {
                    return i;
                }
            }
            return -1;
        }

        // Check for bingo
        function checkForBingo() {
            // This is a simplified check - in a real game, you'd check rows, columns, and diagonals
            // For now, we'll just check if enough numbers are selected
            if (gameState.selectedNumbers.length >= 5) {
                bingoBtn.disabled = false;
            } else {
                bingoBtn.disabled = true;
            }
        }

        // Update called numbers display
        function updateCalledNumbers(numbers) {
            calledNumbers.innerHTML = '';
            
            numbers.forEach(number => {
                const numberElement = document.createElement('div');
                numberElement.className = 'called-number';
                numberElement.textContent = number;
                calledNumbers.appendChild(numberElement);
            });
            
            // Highlight the most recent number
            if (numbers.length > 0) {
                const lastNumber = calledNumbers.lastChild;
                lastNumber.classList.add('recent');
            }
        }

        // Update connection status
        function updateStatus(message, isConnected) {
            statusMessage.textContent = message;
            
            if (isConnected) {
                connectionStatus.classList.add('connected');
                connectionStatus.title = '·ã®·â∞·åà·äì·äò';
            } else {
                connectionStatus.classList.remove('connected');
                connectionStatus.title = '·ã´·àç·â∞·åà·äì·äò';
            }
        }

        // Start a new game
        function startNewGame() {
            if (!gameState.connected) {
                alert('·ä†·åà·àç·åã·ã© ·ä†·àç·â∞·åà·äì·äò·àù·ç¢ ·ä•·â£·ä≠·ãé ·ã≠·å†·â•·âÅ!');
                return;
            }
            
            sendWebSocketMessage({
                type: 'start_game',
                playerId: gameState.playerId
            });
            
            bingoBtn.disabled = true;
        }

        // Toggle autoplay
        function toggleAutoPlay() {
            gameState.autoPlay = !gameState.autoPlay;
            
            if (gameState.autoPlay) {
                autoPlayBtn.textContent = '·à´·àµ-·à∞·à≠ ·ä†·âÅ·àù';
                autoPlayBtn.classList.add('btn-primary');
                autoPlayBtn.classList.remove('btn-secondary');
                
                // Auto-select all already called numbers
                if (gameState.gameActive) {
                    gameState.calledNumbers.forEach(number => {
                        autoSelectNumber(number);
                    });
                }
            } else {
                autoPlayBtn.textContent = '·à´·àµ-·à∞·à≠ ·àò·å´·ãà·âª';
                autoPlayBtn.classList.remove('btn-primary');
                autoPlayBtn.classList.add('btn-secondary');
            }
        }

        // Start autoplay
        function startAutoPlay() {
            if (gameState.autoPlay && gameState.gameActive) {
                gameState.calledNumbers.forEach(number => {
                    autoSelectNumber(number);
                });
            }
        }

        // Claim bingo
        function claimBingo() {
            if (!gameState.gameActive) {
                alert('·å®·ãã·â≥·ãç ·ä†·àç·åÄ·àò·à®·àù·ç¢ ·ä•·â£·ä≠·ãé ·ä†·ã≤·àµ ·å®·ãã·â≥ ·ã≠·åÄ·àù·à©!');
                return;
            }
            
            if (gameState.selectedNumbers.length < 5) {
                alert('·â¢·äï·åé ·àà·àõ·à®·åç ·â¢·ã´·äï·àµ 5 ·âÅ·å•·àÆ·âΩ ·àò·àù·à®·å• ·ä†·àà·â•·ãé·âµ!');
                return;
            }
            
            // Send bingo claim to server
            sendWebSocketMessage({
                type: 'claim_bingo',
                playerId: gameState.playerId,
                gameId: gameState.gameId,
                selectedNumbers: gameState.selectedNumbers
            });
        }

        // Show winner modal
        function showWinnerModal(winner) {
            if (winner === '·ä†·à∏·äì·çä') {
                winnerTitle.textContent = '·â¢·äï·åé! üéâ';
                winnerMessage.textContent = '·ä•·äï·ä≥·äï ·ã∞·àµ ·ã´·àà·ãé! ·â¢·äï·åé ·ä†·à®·åâ!';
            } else {
                winnerTitle.textContent = '·å®·ãã·â≥·ãç ·ä†·àç·âã·àç';
                winnerMessage.textContent = `"${winner}" ·â¢·äï·åé ·ä†·à®·åà·ç¢ ·ã≠·àÖ ·å®·ãã·â≥ ·ä†·àç·âã·àç·ç¢`;
            }
            
            winnerModal.style.display = 'flex';
            gameState.gameActive = false;
        }

        // Setup event listeners
        function setupEventListeners() {
            newGameBtn.addEventListener('click', startNewGame);
            
            autoPlayBtn.addEventListener('click', toggleAutoPlay);
            
            bingoBtn.addEventListener('click', claimBingo);
            bingoBtn.disabled = true;
            
            playAgainBtn.addEventListener('click', () => {
                winnerModal.style.display = 'none';
                startNewGame();
            });
            
            // Handle HTTP fallback for testing
            document.addEventListener('keydown', (e) => {
                // Simulate number call with spacebar (for testing without WebSocket)
                if (e.code === 'Space' && gameState.gameActive) {
                    e.preventDefault();
                    const randomNumber = Math.floor(Math.random() * 75) + 1;
                    handleNumberCalled({type: 'number_called', number: randomNumber});
                }
            });
        }

        // Initialize the game when page loads
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
